<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="本文介绍了如何使用 nix-darwin 为 macOS 配置一个高效的 zsh 环境。作者从 homebrew 切换到 nix，并分享了 nix 的基本配置和 zsh 的详细设置。包括安装 Darwin-nix、配置 nix 环境、zsh 插件安装和配置、字体选择以及 zsh 配置文件的编写。最后，还提供了 powerlevel10k 主题的配置方法和一些实用命令别名和功能。"><title>使用 nix-darwin 为 sonoma 配置一个简洁高效的 zsh</title>
<link rel=canonical href=https://songguokunsgg.github.io/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="使用 nix-darwin 为 sonoma 配置一个简洁高效的 zsh"><meta property='og:description' content="本文介绍了如何使用 nix-darwin 为 macOS 配置一个高效的 zsh 环境。作者从 homebrew 切换到 nix，并分享了 nix 的基本配置和 zsh 的详细设置。包括安装 Darwin-nix、配置 nix 环境、zsh 插件安装和配置、字体选择以及 zsh 配置文件的编写。最后，还提供了 powerlevel10k 主题的配置方法和一些实用命令别名和功能。"><meta property='og:url' content='https://songguokunsgg.github.io/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/'><meta property='og:site_name' content='菘菓菌'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='技术'><meta property='article:published_time' content='2024-04-29T21:02:04+00:00'><meta property='article:modified_time' content='2024-04-29T21:02:04+00:00'><meta name=twitter:title content="使用 nix-darwin 为 sonoma 配置一个简洁高效的 zsh"><meta name=twitter:description content="本文介绍了如何使用 nix-darwin 为 macOS 配置一个高效的 zsh 环境。作者从 homebrew 切换到 nix，并分享了 nix 的基本配置和 zsh 的详细设置。包括安装 Darwin-nix、配置 nix 环境、zsh 插件安装和配置、字体选择以及 zsh 配置文件的编写。最后，还提供了 powerlevel10k 主题的配置方法和一些实用命令别名和功能。"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_598b466302713ded.png width=300 height=325 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>菘菓菌</a></h1><h2 class=site-description>热爱技术，热爱生活，梦想是像风般自由</h2></div></header><ol class=menu-social><li><a href=https://github.com/songguokunsgg target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://zhihu.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/%E9%93%BE%E6%8E%A5/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>链接</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#安装-darwin-nix>安装 Darwin-nix</a></li><li><a href=#nix-基本方案说明>nix 基本方案说明</a></li><li><a href=#nix-简单配置>nix 简单配置</a></li><li><a href=#zsh-配置>zsh 配置</a><ol><li><a href=#配置思路>配置思路</a></li><li><a href=#拉取功能插件>拉取功能插件</a></li><li><a href=#安装字体>安装字体</a></li><li><a href=#编写-zsh-配置文件>编写 zsh 配置文件</a></li><li><a href=#主题配置>主题配置</a></li><li><a href=#搞定收工>搞定收工</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E7%BB%88%E7%AB%AF%E4%B8%8E%E7%BC%96%E8%BE%91%E5%99%A8/>终端与编辑器</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/>使用 nix-darwin 为 sonoma 配置一个简洁高效的 zsh</a></h2><h3 class=article-subtitle>本文介绍了如何使用 nix-darwin 为 macOS 配置一个高效的 zsh 环境。作者从 homebrew 切换到 nix，并分享了 nix 的基本配置和 zsh 的详细设置。包括安装 Darwin-nix、配置 nix 环境、zsh 插件安装和配置、字体选择以及 zsh 配置文件的编写。最后，还提供了 powerlevel10k 主题的配置方法和一些实用命令别名和功能。</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 29, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 7 分钟</time></div></footer></div></header><section class=article-content><p>更新原因：用了很久的 homebrew，感觉不是很完美，就尝试切换到了 nix，挺香的。</p><p>不过本文仅适合入门，nix 也仅配置了 flake 和 configuration，不包括 home-manager（macos 上问题太多）。</p><hr><p>游戏本 xxxx</p><p>macbook ++++</p><p>自己拿一台游戏本，整天折腾 linux，消磨了我很多时光。遂重新审视自己的需求，发现其实游戏玩的不多，故卖之，换 macbook。</p><p>但是终端不像 Arch 那么好配置了，所以还是记录一下吧。</p><h2 id=安装-darwin-nix>安装 Darwin-nix</h2><p>一行代码解决</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sh &lt;<span class=o>(</span>curl -L https://nixos.org/nix/install<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>终端输入 nix，有输出则说明成功，使用 nix 必须使用科学上网工具，如果没有请滑走。</p><h2 id=nix-基本方案说明>nix 基本方案说明</h2><p>本人仅使用 nix 配置终端工具，且不包括 python（我使用自带 python+pdm，更方便，nix 先天不善于处理 python）</p><h2 id=nix-简单配置>nix 简单配置</h2><p>在 ~/.zprofile 中添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=n>NIX_PATH</span><span class=o>=</span><span class=n>darwin</span><span class=o>-</span><span class=n>config</span><span class=o>=$</span><span class=n>HOME</span><span class=o>/.</span><span class=n>nixpkgs</span><span class=o>/</span><span class=n>darwin</span><span class=o>-</span><span class=n>configuration</span><span class=o>.</span><span class=n>nix</span><span class=p>:</span><span class=o>/</span><span class=n>nix</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>nix</span><span class=o>/</span><span class=n>profiles</span><span class=o>/</span><span class=n>per</span><span class=o>-</span><span class=n>user</span><span class=o>/</span><span class=n>root</span><span class=o>/</span><span class=n>channels</span><span class=p>:</span><span class=o>$</span><span class=n>HOME</span><span class=o>/.</span><span class=n>nix</span><span class=o>-</span><span class=n>defexpr</span><span class=o>/</span><span class=n>channels</span><span class=p>:</span><span class=n>nixpkgs</span><span class=o>-</span><span class=n>overlays</span><span class=o>=$</span><span class=n>HOME</span><span class=o>/.</span><span class=n>nixpkgs</span><span class=o>/</span><span class=n>overlays</span><span class=o>/</span><span class=p>:</span><span class=n>nixpkgs</span><span class=o>-</span><span class=n>overlays</span><span class=o>=$</span><span class=n>HOME</span><span class=o>/.</span><span class=n>nixpkgs</span><span class=o>/</span><span class=n>overlays</span><span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><p>然后 clone 我的模板仓库<a class=link href=https://github.com/songguokunsgg/nixos-darwin-config target=_blank rel=noopener>https://github.com/songguokunsgg/nixos-darwin-config</a></p><p>将 clone 下来的文件夹移动为 <code>~/.nixpkgs</code></p><p>将 flake.nix 中的主机名修改为你自己的主机名</p><p>然后 cd 到~/.nixpkgs, 使用以下命令进行第一次安装</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nix run nix-darwin --extra-experimental-features nix-command --extra-experimental-features flakes -- switch --flake .
</span></span></code></pre></td></tr></table></div></div><p>后续使用这两行命令进行升级</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nix flake update ~/.nixpkgs
</span></span><span class=line><span class=cl>darwin-rebuild switch --flake ~/.nixpkgs
</span></span></code></pre></td></tr></table></div></div><p>如果没有找到 darwin-rebuild，检查环境变量。</p><p>仓库的 README 有一些其他说明，可酌情查看。</p><h2 id=zsh-配置>zsh 配置</h2><h3 id=配置思路>配置思路</h3><p>主要用到 4 个插件：</p><ul><li>zsh-autosuggestions</li><li>zsh-syntax-highlighting</li><li>zsh-completions（可选）</li><li>zsh-theme-powerlevel10k（可选）</li></ul><p>前三个是功能性插件，最后一个是主题插件，如果对美观要求不高的话，可以不装最后一个</p><h3 id=拉取功能插件>拉取功能插件</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 自动补全</span>
</span></span><span class=line><span class=cl>git clone --depth<span class=o>=</span><span class=m>1</span> https://github.com/zsh-users/zsh-autosuggestions ~/.zsh/plugins/zsh-autosuggestions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 语法高亮</span>
</span></span><span class=line><span class=cl>git clone --depth<span class=o>=</span><span class=m>1</span> https://github.com/zsh-users/zsh-syntax-highlighting ~/.zsh/plugins/zsh-syntax-highlighting
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 这个插件我也没弄明白是干嘛的，可选。。。。</span>
</span></span><span class=line><span class=cl>git clone --depth<span class=o>=</span><span class=m>1</span> https://github.com/zsh-users/zsh-completions ~/.zsh/plugins/zsh-completions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># p10k 主题</span>
</span></span><span class=line><span class=cl>git clone --depth<span class=o>=</span><span class=m>1</span> https://github.com/romkatv/powerlevel10k.git ~/.zsh/plugins/powerlevel10k
</span></span></code></pre></td></tr></table></div></div><p>将 zsh 的插件统一放置在 ~/.zsh/plugins/ 下</p><h3 id=安装字体>安装字体</h3><p>推荐使用 nerd-fonts-hack 字体作为终端字体</p><p><img src=/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-84f7a6bbb8a6e11575afa1e8731a7d12_b.jpg width=600 height=465 srcset="/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-84f7a6bbb8a6e11575afa1e8731a7d12_b_hu_4180f105b9500937.jpg 480w, /p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-84f7a6bbb8a6e11575afa1e8731a7d12_b_hu_f289ad72d35db28f.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=129 data-flex-basis=309px></p><h3 id=编写-zsh-配置文件>编写 zsh 配置文件</h3><p>环境变量存放位置为 ～/.zprofile，配置文件在 ~/.zshrc，主要编写 ～/. zshrc 文件</p><p>将以下代码加入 .zshrc 以使用插件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
</span></span><span class=line><span class=cl><span class=nb>source</span> ~/.zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
</span></span><span class=line><span class=cl><span class=nb>source</span> ~/.zsh/plugins/zsh-completions/zsh-completions.plugin.zsh
</span></span><span class=line><span class=cl><span class=nb>source</span> ~/.zsh/plugins/powerlevel10k/powerlevel10k.zsh-theme
</span></span></code></pre></td></tr></table></div></div><p>然后进行功能配置，直接复制粘贴下面代码即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl><span class=c1>#color{{{</span>
</span></span><span class=line><span class=cl>autoload -U colors <span class=o>&amp;&amp;</span> colors
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#命令别名 {{{</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>cp</span><span class=o>=</span><span class=s1>&#39;cp -i&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>mv</span><span class=o>=</span><span class=s1>&#39;mv -i&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>rm</span><span class=o>=</span><span class=s1>&#39;rm -i&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>ls</span><span class=o>=</span><span class=s1>&#39;ls -a --color=auto&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>grep</span><span class=o>=</span><span class=s1>&#39;grep --color=auto&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>vim</span><span class=o>=</span><span class=s1>&#39;nvim&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>vi</span><span class=o>=</span><span class=s1>&#39;nvim&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更新软件</span>
</span></span><span class=line><span class=cl><span class=k>function</span> update<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	nix flake update ~/.nixpkgs
</span></span><span class=line><span class=cl>	darwin-rebuild switch --flake ~/.nixpkgs
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清理垃圾</span>
</span></span><span class=line><span class=cl><span class=k>function</span> clean<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	nix-collect-garbage -d
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#终端代理</span>
</span></span><span class=line><span class=cl><span class=nv>hostip</span><span class=o>=</span><span class=s2>&#34;127.0.0.1&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># hostip=$(cat /etc/resolv.conf |grep -oP &#39;(?&lt;=nameserver\ ).*&#39;)</span>
</span></span><span class=line><span class=cl><span class=k>function</span> proxy_on<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>proxy_statu</span><span class=o>=</span><span class=s2>&#34;on&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>https_proxy</span><span class=o>=</span><span class=s2>&#34;http://</span><span class=si>${</span><span class=nv>hostip</span><span class=si>}</span><span class=s2>:7890&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>http_proxy</span><span class=o>=</span><span class=s2>&#34;http://</span><span class=si>${</span><span class=nv>hostip</span><span class=si>}</span><span class=s2>:7890&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>export</span> <span class=nv>all_proxy</span><span class=o>=</span><span class=s2>&#34;socks5://</span><span class=si>${</span><span class=nv>hostip</span><span class=si>}</span><span class=s2>:7890&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;终端代理已开启。&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> proxy_off<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=nb>unset</span> http_proxy https_proxy all_proxy
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> -e <span class=s2>&#34;终端代理已关闭。&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>proxy_statu</span><span class=o>=</span><span class=s2>&#34;off&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> color in RED GREEN YELLOW BLUE MAGENTA CYAN WHITE<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	<span class=nb>eval</span> _<span class=nv>$color</span><span class=o>=</span><span class=s1>&#39;%{$terminfo[bold]$fg[${(L)color}]%}&#39;</span>
</span></span><span class=line><span class=cl>	<span class=nb>eval</span> <span class=nv>$color</span><span class=o>=</span><span class=s1>&#39;%{$fg[${(L)color}]%}&#39;</span>
</span></span><span class=line><span class=cl>	<span class=o>((</span> <span class=nv>count</span> <span class=o>=</span> <span class=nv>$count</span> + <span class=m>1</span> <span class=o>))</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=nv>FINISH</span><span class=o>=</span><span class=s2>&#34;%{</span><span class=nv>$terminfo</span><span class=s2>[sgr0]%}&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#命令提示符</span>
</span></span><span class=line><span class=cl><span class=nv>RPROMPT</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$RED</span><span class=s2>%D %T</span><span class=nv>$FINISH</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>PROMPT</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$CYAN</span><span class=s2>%n@</span><span class=nv>$YELLOW</span><span class=s2>%M:</span><span class=nv>$GREEN</span><span class=s2>%/</span><span class=nv>$_YELLOW</span><span class=s2>&gt;</span><span class=nv>$FINISH</span><span class=s2> &#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#PROMPT=$(echo &#34;$BLUE%M$GREEN%/</span>
</span></span><span class=line><span class=cl><span class=c1>#$CYAN%n@$BLUE%M:$GREEN%/$_YELLOW&gt;&gt;&gt;$FINISH &#34;)</span>
</span></span><span class=line><span class=cl><span class=c1>#标题栏、任务栏样式{{{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nv>$TERM</span> in <span class=o>(</span>*xterm*<span class=p>|</span>*rxvt*<span class=p>|</span><span class=o>(</span>dt<span class=p>|</span>k<span class=p>|</span>E<span class=o>)</span>term<span class=o>)</span>
</span></span><span class=line><span class=cl>	precmd <span class=o>()</span> <span class=o>{</span> print -Pn <span class=s2>&#34;\e]0;%n@%M//%/\a&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>	preexec <span class=o>()</span> <span class=o>{</span> print -Pn <span class=s2>&#34;\e]0;%n@%M//%/\ </span><span class=nv>$1</span><span class=s2>\a&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#编辑器</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EDITOR</span><span class=o>=</span>vim
</span></span><span class=line><span class=cl><span class=c1>#关于历史纪录的配置 {{{</span>
</span></span><span class=line><span class=cl><span class=c1>#历史纪录条目数量</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>HISTSIZE</span><span class=o>=</span><span class=m>10000</span>
</span></span><span class=line><span class=cl><span class=c1>#注销后保存的历史纪录条目数量</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>SAVEHIST</span><span class=o>=</span><span class=m>10000</span>
</span></span><span class=line><span class=cl><span class=c1>#历史纪录文件</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>HISTFILE</span><span class=o>=</span>~/.zhistory
</span></span><span class=line><span class=cl><span class=c1>#以附加的方式写入历史纪录</span>
</span></span><span class=line><span class=cl>setopt INC_APPEND_HISTORY
</span></span><span class=line><span class=cl><span class=c1>#如果连续输入的命令相同，历史纪录中只保留一个</span>
</span></span><span class=line><span class=cl>setopt HIST_IGNORE_DUPS
</span></span><span class=line><span class=cl><span class=c1>#为历史纪录中的命令添加时间戳</span>
</span></span><span class=line><span class=cl>setopt EXTENDED_HISTORY      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#启用 cd 命令的历史纪录，cd -[TAB]进入历史路径</span>
</span></span><span class=line><span class=cl>setopt AUTO_PUSHD
</span></span><span class=line><span class=cl><span class=c1>#相同的历史路径只保留一个</span>
</span></span><span class=line><span class=cl>setopt PUSHD_IGNORE_DUPS
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#每个目录使用独立的历史纪录{{{</span>
</span></span><span class=line><span class=cl>cd<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>builtin</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>                             <span class=c1># do actual cd</span>
</span></span><span class=line><span class=cl>	<span class=nb>fc</span> -W                                       <span class=c1># write current history  file</span>
</span></span><span class=line><span class=cl>	<span class=nb>local</span> <span class=nv>HISTDIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.zsh_history</span><span class=nv>$PWD</span><span class=s2>&#34;</span>      <span class=c1># use nested folders for history</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span>  <span class=o>[</span> ! -d <span class=s2>&#34;</span><span class=nv>$HISTDIR</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=p>;</span> <span class=k>then</span>          <span class=c1># create folder if needed</span>
</span></span><span class=line><span class=cl>		mkdir -p <span class=s2>&#34;</span><span class=nv>$HISTDIR</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>fi</span>
</span></span><span class=line><span class=cl>	<span class=nb>export</span> <span class=nv>HISTFILE</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HISTDIR</span><span class=s2>/zhistory&#34;</span>     <span class=c1># set new history file</span>
</span></span><span class=line><span class=cl>	touch <span class=nv>$HISTFILE</span>
</span></span><span class=line><span class=cl>	<span class=nb>local</span> <span class=nv>ohistsize</span><span class=o>=</span><span class=nv>$HISTSIZE</span>
</span></span><span class=line><span class=cl>	<span class=nv>HISTSIZE</span><span class=o>=</span><span class=m>0</span>                              <span class=c1># Discard previous dir&#39;s history</span>
</span></span><span class=line><span class=cl>	<span class=nv>HISTSIZE</span><span class=o>=</span><span class=nv>$ohistsize</span>                     <span class=c1># Prepare for new dir&#39;s history</span>
</span></span><span class=line><span class=cl>	<span class=nb>fc</span> -R                                       <span class=c1>#read from current histfile</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>mkdir -p <span class=nv>$HOME</span>/.zsh_history<span class=nv>$PWD</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>HISTFILE</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.zsh_history</span><span class=nv>$PWD</span><span class=s2>/zhistory&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> allhistory <span class=o>{</span>
</span></span><span class=line><span class=cl>	cat <span class=k>$(</span>find <span class=nv>$HOME</span>/.zsh_history -name zhistory<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> convhistory <span class=o>{</span>
</span></span><span class=line><span class=cl>	sort <span class=nv>$1</span> <span class=p>|</span> uniq <span class=p>|</span>
</span></span><span class=line><span class=cl>		sed <span class=s1>&#39;s/^:[0−9]∗:[0-9]*;.∗/\1::::::\2/&#39;</span> <span class=p>|</span>
</span></span><span class=line><span class=cl>		awk -F<span class=s2>&#34;::::::&#34;</span> <span class=s1>&#39;{ $1=strftime(&#34;%Y-%m-%d %T&#34;,$1) &#34;|&#34;; print }&#39;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#使用 histall 命令查看全部历史纪录</span>
</span></span><span class=line><span class=cl><span class=k>function</span> histall <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=nv>convhistory</span> <span class=o>=(</span>allhistory<span class=o>)</span> <span class=p>|</span> sed <span class=s1>&#39;/^.\{20\} *cd/i\\&#39;</span> 
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#使用 hist 查看当前目录历史纪录</span>
</span></span><span class=line><span class=cl><span class=k>function</span> hist <span class=o>{</span>
</span></span><span class=line><span class=cl>	convhistory <span class=nv>$HISTFILE</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#全部历史纪录 top50</span>
</span></span><span class=line><span class=cl><span class=k>function</span> top50 <span class=o>{</span> allhistory <span class=p>|</span> awk -F<span class=s1>&#39;:[ 0-9]*:[0-9]*;&#39;</span> <span class=s1>&#39;{ $1=&#34;&#34; ; print }&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/ /\n/g&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;/^$/d&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq -c <span class=p>|</span> sort -nr <span class=p>|</span> head -n <span class=m>50</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#允许在交互模式中使用注释  例如：</span>
</span></span><span class=line><span class=cl>setopt INTERACTIVE_COMMENTS      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#启用自动 cd，输入目录名回车进入目录</span>
</span></span><span class=line><span class=cl>setopt AUTO_CD
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#扩展路径</span>
</span></span><span class=line><span class=cl>setopt complete_in_word
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#禁用 core dumps</span>
</span></span><span class=line><span class=cl>limit coredumpsize <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Emacs风格 键绑定</span>
</span></span><span class=line><span class=cl>bindkey -e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#以下字符视为单词的一部分</span>
</span></span><span class=line><span class=cl><span class=nv>WORDCHARS</span><span class=o>=</span><span class=s1>&#39;*?_-[]~=&amp;;!#$%^(){}&lt;&gt;&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#自动补全功能 {{{</span>
</span></span><span class=line><span class=cl>setopt AUTO_LIST
</span></span><span class=line><span class=cl>setopt AUTO_MENU
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#开启此选项，补全时会直接选中菜单项</span>
</span></span><span class=line><span class=cl>setopt MENU_COMPLETE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>autoload -U compinit
</span></span><span class=line><span class=cl>compinit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#自动补全缓存</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion::complete:*&#39;</span> use-cache on
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion::complete:*&#39;</span> cache-path .zcache
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:cd:*&#39;</span> ignore-parents parent <span class=nb>pwd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#自动补全选项</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> verbose yes
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> menu <span class=k>select</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:default&#39;</span> force-list always
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> <span class=k>select</span>-prompt <span class=s1>&#39;%SSelect:  lines: %L  matches: %M  [%p]&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:match:*&#39;</span> original only
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion::prefix-1:*&#39;</span> completer _complete
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:predict:*&#39;</span> completer _complete
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:incremental:*&#39;</span> completer _complete _correct
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> completer _complete _prefix _correct _prefix _match _approximate
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#路径补全</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> expand <span class=s1>&#39;yes&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> squeeze-shlashes <span class=s1>&#39;yes&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion::complete:*&#39;</span> <span class=s1>&#39;\\&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#彩色补全菜单</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CLICOLOR</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LSCOLORS</span><span class=o>=</span>ExGxFxdaCxDaDahbadeche
</span></span><span class=line><span class=cl>zmodload zsh/complist
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> list-colors <span class=si>${</span><span class=p>(s.:.)LS_COLORS</span><span class=si>}</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:kill:*:processes&#39;</span> list-colors <span class=s1>&#39;=(#b) #([0-9]#)*=0=01;31&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#修正大小写</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> matcher-list <span class=s1>&#39;&#39;</span> <span class=s1>&#39;m:{a-zA-Z}={A-Za-z}&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#错误校正</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> completer _complete _match _approximate
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:match:*&#39;</span> original only
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:approximate:*&#39;</span> max-errors <span class=m>1</span> numeric
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#kill 命令补全</span>
</span></span><span class=line><span class=cl>compdef <span class=nv>pkill</span><span class=o>=</span><span class=nb>kill</span>
</span></span><span class=line><span class=cl>compdef <span class=nv>pkill</span><span class=o>=</span>killall
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:kill:*&#39;</span> menu yes <span class=k>select</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:*:*:processes&#39;</span> force-list always
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:processes&#39;</span> <span class=nb>command</span> <span class=s1>&#39;ps -au$USER&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#补全类型提示分组</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:matches&#39;</span> group <span class=s1>&#39;yes&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> group-name <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:options&#39;</span> description <span class=s1>&#39;yes&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:options&#39;</span> auto-description <span class=s1>&#39;%d&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:descriptions&#39;</span> format <span class=s1>$&#39;\e[01;33m -- %d --\e[0m&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:messages&#39;</span> format <span class=s1>$&#39;\e[01;35m -- %d --\e[0m&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:warnings&#39;</span> format <span class=s1>$&#39;\e[01;31m -- No Matches Found --\e[0m&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:corrections&#39;</span> format <span class=s1>$&#39;\e[01;32m -- %d (errors: %e) --\e[0m&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cd ~ 补全顺序</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:-tilde-:*&#39;</span> group-order <span class=s1>&#39;named-directories&#39;</span> <span class=s1>&#39;path-directories&#39;</span> <span class=s1>&#39;users&#39;</span> <span class=s1>&#39;expand&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##行编辑高亮模式</span>
</span></span><span class=line><span class=cl><span class=c1># Ctrl+@ 设置标记，标记和光标点之间为 region</span>
</span></span><span class=line><span class=cl><span class=nv>zle_highlight</span><span class=o>=(</span>region:bg<span class=o>=</span>magenta <span class=c1>#选中区域</span>
</span></span><span class=line><span class=cl>	special:bold      <span class=c1>#特殊字符</span>
</span></span><span class=line><span class=cl>	isearch:underline<span class=o>)</span><span class=c1>#搜索时使用的关键字</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##空行(光标在行首)补全 &#34;cd &#34; {{{</span>
</span></span><span class=line><span class=cl>user-complete<span class=o>(){</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nv>$BUFFER</span> in
</span></span><span class=line><span class=cl>	<span class=s2>&#34;&#34;</span> <span class=o>)</span>                       <span class=c1># 空行填入 &#34;cd &#34;</span>
</span></span><span class=line><span class=cl>		<span class=nv>BUFFER</span><span class=o>=</span><span class=s2>&#34;cd &#34;</span>
</span></span><span class=line><span class=cl>		zle end-of-line
</span></span><span class=line><span class=cl>		zle expand-or-complete
</span></span><span class=line><span class=cl>		<span class=p>;;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;cd --&#34;</span> <span class=o>)</span>                  <span class=c1># &#34;cd --&#34; 替换为 &#34;cd +&#34;</span>
</span></span><span class=line><span class=cl>		<span class=nv>BUFFER</span><span class=o>=</span><span class=s2>&#34;cd +&#34;</span>
</span></span><span class=line><span class=cl>		zle end-of-line
</span></span><span class=line><span class=cl>		zle expand-or-complete
</span></span><span class=line><span class=cl>		<span class=p>;;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;cd +-&#34;</span> <span class=o>)</span>                  <span class=c1># &#34;cd +-&#34; 替换为 &#34;cd -&#34;</span>
</span></span><span class=line><span class=cl>		<span class=nv>BUFFER</span><span class=o>=</span><span class=s2>&#34;cd -&#34;</span>
</span></span><span class=line><span class=cl>		zle end-of-line
</span></span><span class=line><span class=cl>		zle expand-or-complete
</span></span><span class=line><span class=cl>		<span class=p>;;</span>
</span></span><span class=line><span class=cl>	* <span class=o>)</span>
</span></span><span class=line><span class=cl>		zle expand-or-complete
</span></span><span class=line><span class=cl>		<span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>zle -N user-complete
</span></span><span class=line><span class=cl>bindkey <span class=s2>&#34;\t&#34;</span> user-complete
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##在命令前插入 sudo {{{</span>
</span></span><span class=line><span class=cl><span class=c1>#定义功能</span>
</span></span><span class=line><span class=cl>sudo-command-line<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>[[</span> -z <span class=nv>$BUFFER</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> zle up-history
</span></span><span class=line><span class=cl><span class=o>[[</span> <span class=nv>$BUFFER</span> !<span class=o>=</span> sudo<span class=se>\ </span>* <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>BUFFER</span><span class=o>=</span><span class=s2>&#34;sudo </span><span class=nv>$BUFFER</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>zle end-of-line                 <span class=c1>#光标移动到行末</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>zle -N sudo-command-line
</span></span><span class=line><span class=cl><span class=c1>#定义快捷键为： [Esc] [Esc]</span>
</span></span><span class=line><span class=cl>bindkey <span class=s2>&#34;\e\e&#34;</span> sudo-command-line
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl><span class=c1>#[Esc][h] man 当前命令时，显示简短说明</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> run-help &gt;<span class=p>&amp;</span>/dev/null <span class=o>&amp;&amp;</span> <span class=nb>unalias</span> run-help
</span></span><span class=line><span class=cl>autoload run-help
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#历史命令 top10</span>
</span></span><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>top10</span><span class=o>=</span><span class=s1>&#39;print -l  ${(o)history%% *} | uniq -c | sort -nr | head -n 10&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#路径别名 {{{</span>
</span></span><span class=line><span class=cl><span class=c1>#进入相应的路径时只要 cd ~xxx</span>
</span></span><span class=line><span class=cl><span class=nb>hash</span> -d <span class=nv>A</span><span class=o>=</span><span class=s2>&#34;/media/ayu/dearest&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>hash</span> -d <span class=nv>H</span><span class=o>=</span><span class=s2>&#34;/media/data/backup/ayu&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>hash</span> -d <span class=nv>E</span><span class=o>=</span><span class=s2>&#34;/etc/&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>hash</span> -d <span class=nv>D</span><span class=o>=</span><span class=s2>&#34;/home/ayumi/Documents&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#}}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#补全 ping</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:ping:*&#39;</span> hosts 192.168.1.<span class=o>{</span>1,50,51,100,101<span class=o>}</span> www.google.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#补全 ssh scp sftp 等</span>
</span></span><span class=line><span class=cl>zstyle -e <span class=s1>&#39;:completion::*:*:*:hosts&#39;</span> hosts <span class=s1>&#39;reply=(${=${${(f)&#34;$(cat {/etc/ssh_,~/.ssh/known_}hosts(|2)(N) /dev/null)&#34;}%%[# ]*}//,/ })&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#F1 计算器</span>
</span></span><span class=line><span class=cl>arith-eval-echo<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>LBUFFER</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>LBUFFER</span><span class=si>}</span><span class=s2>echo \$(( &#34;</span>
</span></span><span class=line><span class=cl><span class=nv>RBUFFER</span><span class=o>=</span><span class=s2>&#34; ))</span><span class=nv>$RBUFFER</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>zle -N arith-eval-echo
</span></span><span class=line><span class=cl>bindkey <span class=s2>&#34;^[[11~&#34;</span> arith-eval-echo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> timeconv <span class=o>{</span> date -d @<span class=nv>$1</span> +<span class=s2>&#34;%Y-%m-%d %T&#34;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>zmodload zsh/mathfunc
</span></span><span class=line><span class=cl>autoload -U zsh-mime-setup
</span></span><span class=line><span class=cl>zsh-mime-setup
</span></span><span class=line><span class=cl>setopt EXTENDED_GLOB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>setopt correctall
</span></span><span class=line><span class=cl>autoload compinstall
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#漂亮又实用的命令高亮界面</span>
</span></span><span class=line><span class=cl>setopt extended_glob
</span></span><span class=line><span class=cl><span class=nv>TOKENS_FOLLOWED_BY_COMMANDS</span><span class=o>=(</span><span class=s1>&#39;|&#39;</span> <span class=s1>&#39;||&#39;</span> <span class=s1>&#39;;&#39;</span> <span class=s1>&#39;&amp;&#39;</span> <span class=s1>&#39;&amp;&amp;&#39;</span> <span class=s1>&#39;sudo&#39;</span> <span class=s1>&#39;do&#39;</span> <span class=s1>&#39;time&#39;</span> <span class=s1>&#39;strace&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>recolor-cmd<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nv>region_highlight</span><span class=o>=()</span>
</span></span><span class=line><span class=cl><span class=nv>colorize</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=nv>start_pos</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> arg in <span class=si>${</span><span class=p>(z)BUFFER</span><span class=si>}</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	<span class=o>((</span><span class=nv>start_pos</span><span class=o>+=</span><span class=si>${#</span><span class=nv>BUFFER</span><span class=p>[</span><span class=nv>$start_pos</span><span class=p>+1,-1]</span><span class=si>}</span>-<span class=si>${#${</span><span class=nv>BUFFER</span><span class=p>[</span><span class=nv>$start_pos</span><span class=p>+1,-1]## #</span><span class=si>}}</span><span class=o>))</span>
</span></span><span class=line><span class=cl>	<span class=o>((</span><span class=nv>end_pos</span><span class=o>=</span><span class=nv>$start_pos</span>+<span class=si>${#</span><span class=nv>arg</span><span class=si>}</span><span class=o>))</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nv>$colorize</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>		<span class=nv>colorize</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl>		<span class=nv>res</span><span class=o>=</span><span class=k>$(</span><span class=nv>LC_ALL</span><span class=o>=</span>C <span class=nb>builtin</span> <span class=nb>type</span> <span class=nv>$arg</span> 2&gt;/dev/null<span class=k>)</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nv>$res</span> in
</span></span><span class=line><span class=cl>			*<span class=s1>&#39;reserved word&#39;</span>*<span class=o>)</span>   <span class=nv>style</span><span class=o>=</span><span class=s2>&#34;fg=magenta,bold&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>			*<span class=s1>&#39;alias for&#39;</span>*<span class=o>)</span>       <span class=nv>style</span><span class=o>=</span><span class=s2>&#34;fg=cyan,bold&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>			*<span class=s1>&#39;shell builtin&#39;</span>*<span class=o>)</span>   <span class=nv>style</span><span class=o>=</span><span class=s2>&#34;fg=yellow,bold&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>			*<span class=s1>&#39;shell function&#39;</span>*<span class=o>)</span>  <span class=nv>style</span><span class=o>=</span><span class=s1>&#39;fg=green,bold&#39;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>			*<span class=s2>&#34;</span><span class=nv>$arg</span><span class=s2> is&#34;</span>*<span class=o>)</span>
</span></span><span class=line><span class=cl>				<span class=o>[[</span> <span class=nv>$arg</span> <span class=o>=</span> <span class=s1>&#39;sudo&#39;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>style</span><span class=o>=</span><span class=s2>&#34;fg=red,bold&#34;</span> <span class=o>||</span> <span class=nv>style</span><span class=o>=</span><span class=s2>&#34;fg=blue,bold&#34;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>			*<span class=o>)</span>                   <span class=nv>style</span><span class=o>=</span><span class=s1>&#39;none,bold&#39;</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>		<span class=k>esac</span>
</span></span><span class=line><span class=cl>		<span class=nv>region_highlight</span><span class=o>+=(</span><span class=s2>&#34;</span><span class=nv>$start_pos</span><span class=s2> </span><span class=nv>$end_pos</span><span class=s2> </span><span class=nv>$style</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=k>fi</span>
</span></span><span class=line><span class=cl>	<span class=o>[[</span> <span class=si>${${</span><span class=nv>TOKENS_FOLLOWED_BY_COMMANDS</span><span class=p>[(r)</span><span class=si>${</span><span class=nv>arg</span><span class=p>//|/</span><span class=se>\|</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=p>:+yes</span><span class=si>}</span> <span class=o>=</span> <span class=s1>&#39;yes&#39;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>colorize</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>	<span class=nv>start_pos</span><span class=o>=</span><span class=nv>$end_pos</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>check-cmd-self-insert<span class=o>()</span> <span class=o>{</span> zle .self-insert <span class=o>&amp;&amp;</span> recolor-cmd <span class=o>}</span>
</span></span><span class=line><span class=cl>check-cmd-backward-delete-char<span class=o>()</span> <span class=o>{</span> zle .backward-delete-char <span class=o>&amp;&amp;</span> recolor-cmd <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>zle -N self-insert check-cmd-self-insert
</span></span><span class=line><span class=cl>zle -N backward-delete-char check-cmd-backward-delete-char
</span></span></code></pre></td></tr></table></div></div><h3 id=主题配置>主题配置</h3><p>p10k 在首次进入时需要进行配置，按照提示进行即可，配置之后，会在 zshrc 行首和行尾分别添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>if [[ -r &#34;${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh&#34; ]]; then
</span></span><span class=line><span class=cl>  source &#34;${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh&#34;
</span></span><span class=line><span class=cl>fi
</span></span></code></pre></td></tr></table></div></div><p>以及</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
</span></span><span class=line><span class=cl>[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
</span></span></code></pre></td></tr></table></div></div><p>需要把上面三句代码移动到 4 个 source 的后面，否则每次启动终端都会报错</p><p><img src=/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-f6eca7374890887d630bff2c420a11a5_b.jpg width=720 height=343 srcset="/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-f6eca7374890887d630bff2c420a11a5_b_hu_9de9ed02426e3d28.jpg 480w, /p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-f6eca7374890887d630bff2c420a11a5_b_hu_d1f6364103fed724.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=209 data-flex-basis=503px></p><h3 id=搞定收工>搞定收工</h3><p><img src=/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-3995831831ab86eb202942a276d94213_b.jpg width=720 height=475 srcset="/p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-3995831831ab86eb202942a276d94213_b_hu_cbfcc6e37b105198.jpg 480w, /p/%E4%BD%BF%E7%94%A8-nix-darwin-%E4%B8%BA-sonoma-%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%AE%80%E6%B4%81%E9%AB%98%E6%95%88%E7%9A%84-zsh/v2-3995831831ab86eb202942a276d94213_b_hu_9e0cb22a2fb2ff37.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=151 data-flex-basis=363px></p></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%8A%80%E6%9C%AF/>技术</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/%E7%94%A8%E6%9C%80%E5%B0%91%E7%9A%84%E6%97%B6%E9%97%B4%E6%89%93%E9%80%A0%E4%B8%80%E4%B8%AA%E5%BC%BA%E5%A4%A7%E7%9A%84-neovim/><div class=article-details><h2 class=article-title>用最少的时间打造一个强大的 neovim</h2></div></a></article><article><a href=/p/%E7%9C%9F%E9%A6%99%E8%AD%A6%E5%91%8A2024-%E5%B9%B4%E4%B8%AD%E7%9A%84-vscode-latex-%E5%86%99%E4%BD%9C/><div class=article-details><h2 class=article-title>真香警告，2024 年中的 vscode+latex 写作</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 菘菓菌</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>