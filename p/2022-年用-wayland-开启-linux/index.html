<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="这篇文章讨论了 2022 年使用 Wayland 作为 Linux 显示服务器的体验。作者提到了一些不适合使用 Linux 和 Wayland 的场景，如依赖特定软件的用户。文章还提供了 NVIDIA 显卡的 Wayland 配置指南，讨论了 Wayland 的优缺点，包括动画效果、软件兼容性问题、远程功能差等。作者分享了解决字体大小、输入法和多屏显示问题的方法，并提供了一些特定应用（如 Steam、腾讯会议）在 Wayland 环境下的解决方案。总的来说，文章提供了一个关于在 Linux 上使用 Wayland 的实用指南，包括一些常见问题的解决方法。3"><title>2022 年，用 Wayland 开启 linux</title>
<link rel=canonical href=https://songguokunsgg.github.io/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="2022 年，用 Wayland 开启 linux"><meta property='og:description' content="这篇文章讨论了 2022 年使用 Wayland 作为 Linux 显示服务器的体验。作者提到了一些不适合使用 Linux 和 Wayland 的场景，如依赖特定软件的用户。文章还提供了 NVIDIA 显卡的 Wayland 配置指南，讨论了 Wayland 的优缺点，包括动画效果、软件兼容性问题、远程功能差等。作者分享了解决字体大小、输入法和多屏显示问题的方法，并提供了一些特定应用（如 Steam、腾讯会议）在 Wayland 环境下的解决方案。总的来说，文章提供了一个关于在 Linux 上使用 Wayland 的实用指南，包括一些常见问题的解决方法。3"><meta property='og:url' content='https://songguokunsgg.github.io/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/'><meta property='og:site_name' content='菘菓菌'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='技术'><meta property='article:published_time' content='2022-10-25T16:32:54+00:00'><meta property='article:modified_time' content='2022-10-25T16:32:54+00:00'><meta name=twitter:title content="2022 年，用 Wayland 开启 linux"><meta name=twitter:description content="这篇文章讨论了 2022 年使用 Wayland 作为 Linux 显示服务器的体验。作者提到了一些不适合使用 Linux 和 Wayland 的场景，如依赖特定软件的用户。文章还提供了 NVIDIA 显卡的 Wayland 配置指南，讨论了 Wayland 的优缺点，包括动画效果、软件兼容性问题、远程功能差等。作者分享了解决字体大小、输入法和多屏显示问题的方法，并提供了一些特定应用（如 Steam、腾讯会议）在 Wayland 环境下的解决方案。总的来说，文章提供了一个关于在 Linux 上使用 Wayland 的实用指南，包括一些常见问题的解决方法。3"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_598b466302713ded.png width=300 height=325 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>菘菓菌</a></h1><h2 class=site-description>热爱技术，热爱生活，梦想是像风般自由</h2></div></header><ol class=menu-social><li><a href=https://github.com/songguokunsgg target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://zhihu.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/%E9%93%BE%E6%8E%A5/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>链接</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#nvidia-显卡的配置intel-和-amd-显卡无需配置>nvidia 显卡的配置（intel 和 AMD 显卡无需配置）</a><ol><li><a href=#nvidia-单显卡包括开启独显直连的情况>nvidia 单显卡（包括开启独显直连的情况）</a></li></ol></li><li><a href=#也可以直接修改-bootgrubgrubcfg-文件不过不太安全慎用>也可以直接修改 /boot/grub/grub.cfg 文件，不过不太安全，慎用。</a><ol><li><a href=#in-双显卡笔记本推荐方案>I+N 双显卡（笔记本推荐方案）</a></li></ol></li><li><a href=#缩放功能的改进>缩放功能的改进</a><ol><li><a href=#一个小小的猜想>一个小小的猜想</a></li></ol></li><li><a href=#wayland-的优点>wayland 的优点</a></li><li><a href=#wayland-的缺点>wayland 的缺点</a></li><li><a href=#界面字体太小以解决安装-kde526-即可>界面字体太小（以解决，安装 KDE5.26 即可）</a></li><li><a href=#alacritty-无法显示输入法>Alacritty 无法显示输入法</a></li><li><a href=#wechat-uos-字体太小>wechat-uos 字体太小</a></li><li><a href=#steam-游戏问题>steam 游戏问题</a><ol><li><a href=#题外话>题外话</a></li><li><a href=#steam-的缩放功能>steam 的缩放功能</a></li></ol></li><li><a href=#将-electron-应用跑在-wayland-上>将 electron 应用跑在 wayland 上</a><ol><li><a href=#启动选项修改为>启动选项修改为</a></li></ol></li><li><a href=#多屏显示问题已解决>多屏显示问题（已解决）</a></li><li><a href=#腾讯会议问题>腾讯会议问题</a><ol><li><a href=#安装-obs-studio>安装 obs-studio</a></li><li><a href=#安装-v4l2loopback-虚拟摄像机功能>安装 v4l2loopback 虚拟摄像机功能</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%9D%82%E8%B0%88/>操作系统杂谈</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/>2022 年，用 Wayland 开启 linux</a></h2><h3 class=article-subtitle>这篇文章讨论了 2022 年使用 Wayland 作为 Linux 显示服务器的体验。作者提到了一些不适合使用 Linux 和 Wayland 的场景，如依赖特定软件的用户。文章还提供了 NVIDIA 显卡的 Wayland 配置指南，讨论了 Wayland 的优缺点，包括动画效果、软件兼容性问题、远程功能差等。作者分享了解决字体大小、输入法和多屏显示问题的方法，并提供了一些特定应用（如 Steam、腾讯会议）在 Wayland 环境下的解决方案。总的来说，文章提供了一个关于在 Linux 上使用 Wayland 的实用指南，包括一些常见问题的解决方法。3</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Oct 25, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 3 分钟</time></div></footer></div></header><section class=article-content><p>虽然标题被我改成这样，但我仍然不建议主力机使用 linux, 除非你一定不会使用以下功能之一：</p><ul><li>MSOffice</li><li>onedrive</li><li>重度依赖 QQ 和微信</li><li>一些专用工业软件</li><li>公司独有软件</li><li>iTunes</li><li>visual studio 等</li><li>钉钉（视频分享模糊，其他功能正常）</li></ul><p>以下用户请慎重使用 wayland，说不定会让你直接放弃 linux</p><ul><li>使用 nvidia 单显卡</li></ul><p>我的主力机体验了一下就回 win11 了，现在配的垃圾台式（e3 1230 + rx580）还坚持着 arch，用着还挺爽。</p><hr><p><strong>2022 年 10 月 23 日更新一波</strong>，之前因为一些软件用不了，我又回到了 win11，还小小的升级了一波配置（从 i7+3050 成为了 i7 加 3060）但是有些操作在 win 下面还是不太方便，于是我又把 linux 装上了，这次为了省事装的 manjaro，然后把源换成了 arch 的，但是，问题太多（我太天真了），最后还是换回了 arch</p><p><img src=/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-fc265bbfea913a5ef41f421b1b9a6af6_b.jpg width=720 height=573 srcset="/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-fc265bbfea913a5ef41f421b1b9a6af6_b_hu_96dd0d3a145525a2.jpg 480w, /p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-fc265bbfea913a5ef41f421b1b9a6af6_b_hu_381fde6ab45c265d.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=125 data-flex-basis=301px></p><p>我的配置（开了独显直连）</p><p>经过几个月的发展，wayland 又取得了一些进步，我觉得离取代 xorg 只剩最后一步了（<strong>Electron 输入法问题</strong>）。</p><h2 id=nvidia-显卡的配置intel-和-amd-显卡无需配置>nvidia 显卡的配置（intel 和 AMD 显卡无需配置）</h2><p>5.18 及之后的内核需要在内核启动参数中添加 ibt=off，才可以启动成功</p><h3 id=nvidia-单显卡包括开启独显直连的情况>nvidia 单显卡（包括开启独显直连的情况）</h3><p>如果不开独显直连，那安装很简单，开了的话会复杂一点，类似于 nvidia 主机装 wayland.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GBM_BACKEND=nvidia-drm
</span></span><span class=line><span class=cl>__GLX_VENDOR_LIBRARY_NAME=nvidia
</span></span></code></pre></td></tr></table></div></div><p>需要把这两行添加到 <code>/etc/profile</code> 中，然后修改内核 <code>/etc/defualt/grub</code></p><p>也就是在这一行后面添加 <code>nvidia-drm.modeset=1</code>，也可以启动的时候添加，但每次都需要操作，麻烦，改完之后如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet udev.log_priority=3 nvidia-drm.modeset=1&#34;
</span></span></code></pre></td></tr></table></div></div><p>然后使用 <code>update-grub</code>（没有的话 AUR 安装）命令更新 grub，重启就可以使用 wayland-session 了，如果没有这个命令，或者直接</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></td></tr></table></div></div><h2 id=也可以直接修改-bootgrubgrubcfg-文件不过不太安全慎用>也可以直接修改 /boot/grub/grub.cfg 文件，不过不太安全，慎用。</h2><h3 id=in-双显卡笔记本推荐方案>I+N 双显卡（笔记本推荐方案）</h3><p>在不做专门配置的情况下，默认使用了 intel 核显，在有需要的时候通过 <code>prime-run</code> 调用独显，因此不用过多的配置。但在 5.18 之后的内核仍然需要禁用 ibt。</p><p>笔记本推荐使用双显卡，主要是因为 nvidia 对 wayland 支持实在太差，当然，如果你使用 x11，那么开独显直连也不错。</p><h2 id=缩放功能的改进>缩放功能的改进</h2><p>这个改进是 KDE 做的，因此只适用于 KDE，并且版本必须高于 5.26.</p><p>之前有说到，xwayland 应用在 wayland 缩放下面会很糊，这是由于 xwayland 的缩放策略是直接按比例放大所导致的，而我之前给出的解决方案是<strong>不缩放 wayland，而是使用大字体曲线救国</strong>，xwayland 应用在内部单独缩放。这样做能解决一些问题，但也带来了一些问题，例如不美观等。而 KDE5.26 提供了<strong>x 应用单独缩放</strong>的功能，</p><p><img src=/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-f01949a210120b8b1587f7ec1d491df2_b.jpg width=600 height=446 srcset="/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-f01949a210120b8b1587f7ec1d491df2_b_hu_164b6651295254a2.jpg 480w, /p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-f01949a210120b8b1587f7ec1d491df2_b_hu_f124a4026473e6e7.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=134 data-flex-basis=322px></p><p>可以看到 x11 应用可以单独走自身的缩放，经过测试，这个功能非常好。electron 应用对 wayland 支持较差，主要表现在中文输入法无法使用（目前无解），也就是说，在以前，你必须二选一：不缩放，使用 xwayland，拥有输入法功能；缩放，使用 wayland 后端，但输入法无了，只能用剪切板。而现在，你可以使用 xwayland 二者得兼。</p><p>经过测试，<strong>edge、vscode、vscode-insider 完全正常</strong>，无模糊现象。</p><p>而其他平台对 wayland 支持越来越好，奇怪的问题或许会少很多。</p><h3 id=一个小小的猜想>一个小小的猜想</h3><p>之前有提到，我在双显卡模式下，无法外接显示器，这是因为 HDMI 和 TypeC 接口都是连接在 nvidia 显卡上导致的，因此，无法独显直连的笔记本修改了 nvidia 后端和 grub 之后，或许可以使用外接屏（纯猜想，我就不折腾了）</p><p>现在的 linux 发行版对于 wayland 的支持都做得还算不错了，但是有些问题还是需要自己解决，所以很想写一篇体验文 + 排坑文。</p><p>我所使用的桌面环境为 plasma 5.25 版本，从 X11 切换到 wayland 十分方便</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pacman -S plasma-wayland-session plasma-wayland-protocols qt5-wayland qt6-wayland xorg-xwayland
</span></span></code></pre></td></tr></table></div></div><p>装上这些个玩意之后，就可以在 sddm 中看见 plasma(wayland) 选项，选择之后就可以进入 wayland 的 kde.</p><p>从 设置 - 关于本系统 中可以看到图形平台为 <strong>wayland</strong>.</p><h2 id=wayland-的优点>wayland 的优点</h2><p>整体动画和特效很惊艳，没有了 X11 那种山寨的感觉，纯 wayland 环境下完全没有屏幕撕裂，实时帧率远高于 X11 环境（gnome 尤其明显，kde 不仔细感受倒是看不出来）。</p><h2 id=wayland-的缺点>wayland 的缺点</h2><ul><li>软件兼容性一般，许多应用还没有做适配，实际是跑在 xwayland 上面的。</li><li>wine 兼容性不太好，wine-qq 容易出现拖影和花屏的情况（无解）。</li><li>报废了绝大多数录屏和截图软件，必须寻找<strong>适配 wayland</strong>的（建议 spectacle 和 obs-studio）。</li><li>不能全局缩放，会导致字体模糊发虚，没找到解决方法，但是在一些应用中，可以手动指定启动参数，使应用单独缩放，并且字体不会发虚（KDE5.26 已经解决）。</li><li>不再是 Client-Server 模式，天生远程功能差（可以用 wayvnc）。</li></ul><p>整体来看，kde 在 wayland 下表现非常好，用作日常使用完全没有问题，但是最好在一开始，就先解决一些问题。</p><h2 id=界面字体太小以解决安装-kde526-即可>界面字体太小（以解决，安装 KDE5.26 即可）</h2><p>X11 下往往通过全局缩放来解决，但 wayland 下我们只能退而求其次，通过修改字体大小来解决。</p><p>根据我测试，字体修改之后，UI 也被跟着一起修改了，不会出现奇怪的视觉效果，体验还不错（比起发虚）。</p><p>设置 - 外观 - 字体</p><p>将字号调大为之前的 n 倍即可</p><p>然后在 edge、chrome、vscode 等 electron 软件中单独设置界面缩放。</p><h2 id=alacritty-无法显示输入法>Alacritty 无法显示输入法</h2><p>我使用 Alacritty 终端，在 wayland 下只能输入英文，所以我们用 X 启动它，在 /usr/share/applications/Alacritty.desktop 中修改带 Exec 的行为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  3 TryExec=env WINIT_UNIX_BACKEND=x11 alacritty
</span></span><span class=line><span class=cl>  4 Exec=env WINIT_UNIX_BACKEND=x11 alacritty
</span></span></code></pre></td></tr></table></div></div><p>即可解决输入问题，其他终端类似。</p><p>也可以更换支持 xwayland 和 wayland 的终端，例如 electerm 和 konsole，但这个软件性能太差，不推荐使用。</p><p>7 月 22 日：我用回了 kde 自带的 konsole，慢点就慢点吧，还算好用。。。。</p><h2 id=wechat-uos-字体太小>wechat-uos 字体太小</h2><p>electron 应用大多数默认跑在 xwayland，<strong>无法通过全局缩放方式解决（除非你能忍受字体发虚）在 KDE 中，已经不存在这个问题，x 应用能够单独设置缩放，绝对是个划时代功能。</strong></p><p>修改 /usr/share/applications/wechat-uos.desktop 中的 Exec 行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>  3 Exec=wechat-uos --force-device-scale-factor=1.5 %U
</span></span></code></pre></td></tr></table></div></div><p>可以缩放为之前的 1.5 倍</p><p>部分软件可以实现缩放（<strong>迅雷</strong>也可以），部分不行（例如 steam），感觉基于 electron 开发的大多数都可行。</p><p>我们也可以指定参数跑在 wayland 上（后文）</p><p>6 月 20 日更新</p><h2 id=steam-游戏问题>steam 游戏问题</h2><p>steam 上的一些游戏是支持 wayland 的，但也有个别不支持，比如 dota2</p><p>steam 允许为每个游戏单独指定运行环境</p><p>右键 dota2-属性 - 启动选项</p><p>填入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SDL_VIDEODRIVER=x11 prime-run %COMMAND% -perfectworld
</span></span></code></pre></td></tr></table></div></div><p>SDL_VIDEODRIVER=x11：以 x11 运行游戏</p><p>prime-run：使用独显运行（仅限 nvidia 双显卡，<strong>独显直连无需操作</strong>）</p><p>%COMMAND% （启动命令）</p><p>-perfectworld（进入国服）</p><p>进入游戏之后没有自动全屏，需要根据你的快捷键设置（我是 F11）手动全屏</p><h3 id=题外话>题外话</h3><p>steam 本身也是不支持 wayland 的，他本身就跑在 xwayland 上</p><p>启动 steam 后输入命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>xlsclients -a
</span></span></code></pre></td></tr></table></div></div><p>可以看到输出有：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;user&gt;  electron
</span></span><span class=line><span class=cl>&lt;user&gt;  microsoft-edge
</span></span><span class=line><span class=cl>&lt;user&gt;  steam
</span></span></code></pre></td></tr></table></div></div><p>steam、edge 和 icalingua++（就是那个 electron）都是跑在 xwayland 上的，wechat-uos 也是跑在 xwayland 上。</p><h3 id=steam-的缩放功能>steam 的缩放功能</h3><p>steam 无法使用系统的缩放比例，但它本身是可以缩放的，在 steam.desktop 文件的 Exec 行添加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GDK_SCALE=2
</span></span></code></pre></td></tr></table></div></div><p>就可以进行 2 倍缩放，目前只支持两倍，所以 1080p 的用户就忍忍吧，2k 可以 2 倍没有问题</p><h2 id=将-electron-应用跑在-wayland-上>将 electron 应用跑在 wayland 上</h2><p>很简单，加参数就行，仍然以 wechat-uos 为例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /usr/share/applications/wechat-uos.desktop
</span></span></code></pre></td></tr></table></div></div><h3 id=启动选项修改为>启动选项修改为</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Exec=wechat-uos --enable-features=UseOzonePlatform  --ozone-platform=wayland %U
</span></span></code></pre></td></tr></table></div></div><p><strong>注意，wayland 参数与前文缩放参数只能选一个，否则无法启动！！</strong></p><p><strong>electron12 及以后的程序几乎都可以这么设置</strong></p><p><strong>发现一件有趣的事：wechat-uos 可以通过 ctrl+"+&ldquo;进行放大，不必指定参数，直接冲 wayland 吧。</strong></p><p><strong>又发现一件可悲的事，wayland 下的 electron 输入法直接无了，只能依靠剪切板，如何抉择，见仁见智了。</strong></p><p>听说等 wayland 支持 gtk4 之后，输入法问题将会解决。</p><hr><p>7 月 23 日 更新一波</p><h2 id=多屏显示问题已解决>多屏显示问题（已解决）</h2><p>在我的设备上 wayland-session 无法检测到第二块屏幕，无论是 kde 还是 gnome。<strong>切换到 x11 后均正常</strong>，但是我查了很多资料，都没能解决这个问题。。。所以欢迎已经解决这个问题的朋友教教我（求）。</p><p><strong>2022.10 月更新</strong></p><p>这是由于笔记本 HDMI 接口和 T-c 接口直连了 nvidia 显卡导致的解决方案在最上面已经给出，但目前只是猜想（不想拿主力机做实验了）</p><h2 id=腾讯会议问题>腾讯会议问题</h2><p>众所周知，腾讯会议不支持 wayland，可以用，但不能使用屏幕分享，解决方案：使用 obs 的虚拟摄像头连接屏幕，然后腾讯会议连摄像头即可</p><h3 id=安装-obs-studio>安装 obs-studio</h3><p>据说在 gnome 上有一个专门的录屏软件，叫做 **kooha，**不过我用的是 kde，这款软件在 kde 上是无法使用的，所以我们最好通过 OBS Studio 进行录屏。</p><p>但是要确保你安装使用了 pipewire.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pacman -S obs-studio
</span></span></code></pre></td></tr></table></div></div><p>除此之外，还需要安装两个软件包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pacman -S xdg-desktop-portal-wlr libpipewire02
</span></span></code></pre></td></tr></table></div></div><p>如果不安装这两个软件包，在 obs 中是不会显示 <strong>屏幕采集 (pipewire) 选项的。</strong></p><p>安装好之后打开 obs</p><p>![]((20221025)2022_年用 Wayland 开启 linux_EberyThingSay/v2-e32ea9af148b5d86a93ea0081d691ef2_b.jpg)<br>然后就可以进行 屏幕录制，视频播放器我选择了 mpv，非常好用。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pacman -S mpv
</span></span></code></pre></td></tr></table></div></div><h3 id=安装-v4l2loopback-虚拟摄像机功能>安装 v4l2loopback 虚拟摄像机功能</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pacman -S v4l2loopback
</span></span></code></pre></td></tr></table></div></div><p>新版 obs 已经原生支持虚拟摄像机，所以无需过多配置</p><p>重点是下面两个命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo modprobe --remove v4l2loopback
</span></span><span class=line><span class=cl>sudo modprobe v4l2loopback <span class=nv>devices</span><span class=o>=</span><span class=m>2</span>
</span></span></code></pre></td></tr></table></div></div><p>第一行是移除虚拟相机</p><p>第二行是添加虚拟相机</p><p>可以 alias 一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>alias</span> <span class=nv>vcam</span><span class=o>=</span><span class=s1>&#39;sudo modprobe --remove v4l2loopback &amp;&amp; sudo modprobe v4l2loopback devices=2&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>这样每次 vcam 一下就可以开启虚拟摄像机功能了</p><p><img src=/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-6205a336f5e9cce5d11afe9d9fb8f5b9_b.jpg width=600 height=441 srcset="/p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-6205a336f5e9cce5d11afe9d9fb8f5b9_b_hu_288ed7a5f1e8c974.jpg 480w, /p/2022-%E5%B9%B4%E7%94%A8-wayland-%E5%BC%80%E5%90%AF-linux/v2-6205a336f5e9cce5d11afe9d9fb8f5b9_b_hu_edae84a80fc748f8.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=136 data-flex-basis=326px><br>如果点了虚拟摄像机没反应，vcam 一下就行了，这个摄像机将会出现在腾讯会议中，实现屏幕共享。</p><p><strong>其他直播软件，包括钉钉在内，只要可以连接摄像头，理论上都是可行的</strong></p></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%8A%80%E6%9C%AF/>技术</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/windows--openwrt-%E5%BC%82%E5%9C%B0-zerotier-%E7%BB%84%E7%BD%91/><div class=article-details><h2 class=article-title>Windows + OpenWRT 异地 Zerotier 组网</h2></div></a></article><article><a href=/p/%E8%87%AA%E8%A1%8C%E7%BC%96%E8%AF%91%E5%AE%9A%E5%88%B6-immortalwrt/><div class=article-details><h2 class=article-title>自行编译定制 immortalWRT</h2></div></a></article><article><a href=/p/%E5%B8%B8%E7%94%A8%E7%9A%84-windows-%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC/><div class=article-details><h2 class=article-title>常用的 Windows 配置脚本</h2></div></a></article><article><a href=/p/pve-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/><div class=article-details><h2 class=article-title>PVE 内网穿透</h2></div></a></article><article><a href=/p/kde-i3-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%8A%9F%E8%83%BD%E5%B9%B3%E9%93%BA%E5%BC%8F%E6%A1%8C%E9%9D%A2arch/><div class=article-details><h2 class=article-title>KDE+i3 配置全功能平铺式桌面（Arch）</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 菘菓菌</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>